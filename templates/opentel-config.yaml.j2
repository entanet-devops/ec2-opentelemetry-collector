{% if otel_config_override %}
{{ otel_config_override }}
{% else %}
receivers:
  otlp:
    protocols:
      http:
        endpoint: "localhost:4317"
  prometheus:
    config:
      scrape_configs:
        - job_name: 'node_exporter'
          scrape_interval: 15s
          static_configs:
            - targets:
                - "localhost:9100"
  filelog:
    include:
      - /apps/*/storage/logs/laravel.log
      - /var/log/nginx/access.log
      - /var/log/nginx/error.log
processors:
  resourcedetection:
    detectors:
      - ec2
    ec2:
      tags:
        - ^.*$
exporters:
  debug:
    verbosity: {{ otel_debug_level }}
  otlphttp:
    endpoint: {{ monitoring_endpoint }}
    retry_on_failure:
      enabled: true
      initial_interval: 5s
      max_interval: 30s
      max_elapsed_time: 300s
    sending_queue:
      enabled: true
      num_consumers: 10
      queue_size: 5000
    timeout: 30s
service:
  pipelines:
    logs:
      receivers:
        - filelog
      processors:
        - resourcedetection
      exporters:
        - otlphttp
    metrics:
      receivers:
        - prometheus
      processors:
        - resourcedetection
      exporters:
        - otlphttp
        - debug
    traces:
      receivers:
        - otlp
      processors:
        - resourcedetection
      exporters:
        - otlphttp
        - debug
{% endif %}